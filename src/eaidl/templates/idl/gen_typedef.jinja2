{% from "idl/gen_notes.jinja2" import gen_notes %}
{% from "idl/gen_annotations.jinja2" import gen_annotations %}
{#
    Generate tyoedef declaration.
    Typedef appears only once, either in declaration or definition section.
#}
{% macro gen_typedef(cls) %}
{%- set min_length = cls.properties.get(config.min_length) %}
{%- set max_length = cls.properties.get(config.max_length) %}
{%- set is_fixed_array = min_length and max_length and min_length.value == max_length.value %}
{%- set is_bounded_string = max_length and cls.parent_type in ['string', 'wstring', 'str'] %}
{{ gen_notes(cls) -}}
{%- if is_bounded_string %}
{{ gen_annotations(cls.properties, None, [config.max_length]) -}}
typedef {{cls.parent_type | idl_type}}<{{max_length.value}}> {{cls.name}};
{%- elif is_fixed_array %}
{{ gen_annotations(cls.properties, None, [config.min_length, config.max_length]) -}}
typedef {{cls.parent_type | idl_type}} {{cls.name}}[{{max_length.value}}];
{%- else %}
{{ gen_annotations(cls.properties) -}}
typedef {{cls.parent_type | idl_type}} {{cls.name}};
{%- endif %}
{%- endmacro %}